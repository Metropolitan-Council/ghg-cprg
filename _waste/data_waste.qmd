# Methods

```{r  include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  fig.pos = "H",
  out.width = "100%",
  dpi = 300
)


knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
```
```{r, include=FALSE}
source(file.path(here::here(), "R/_quarto_helpers.R"))
source(file.path(here::here(), "R/_load_pkgs.R"))
source(file.path(here::here(), "R/_plotting_helpers.R"))
hookaddcap()
```

## Data Sources

{{< include data_mpca_score_2021.qmd >}}

### MPCA Waste Characterization Study

In 2013, the MPCA contracted with Burns & McDonnell Engineering Company, Inc. to conduct a waste characterization study of landfill waste, an update to an earlier study in the year 2000. For simplicity, we have chosen to set waste proportions equal to those 2013 values for all years in this inventory.

The study sampled waste makeup from six waste disposal facilities across the state and used the results to model statewide totals. More details can be found in study documentation, (cite).

This data is a high-quality state-level dataset.

For consistency, the values in this study have been compared to the IPCC default waste breakdown for North America. Relevant values were found to be consistent within 90% confidence intervals (as reported in the MPCA study), with the exception of food waste. IPCC values attribute 33.9% of landfill waste to food waste, while the 2013 report only finds that 17.8% of landfill waste is food waste. There are many possible explanations for this discrepancy, including differences in waste breakdown across the North American region and the possibility that the IPCC's numbers reflect additional food waste processed in organics facilities, which would not be included in the MPCA study.

Due to the fact that it is more recent and more specific to the Minnesota region, we have chosen the MPCA study as the source of truth in this case.

<!-- If necessary, display final breakdown of percentages aligned with DOC calculation categories here. -->

{{< include data_wi_emissions.qmd >}}

### EPA Methane Recovery Data {#sec-epa-methane}

The EPA generates methane flaring and landfill gas to energy data for each state as part of its State Inventory Tool for solid waste. This data is collected as part of the [Landfill Methane Outreach Program](https://www.epa.gov/lmop). 

However, since this data is collected on a national level, there are potential discrepancies with state-level and especially regional breakdowns of methane recovery. Due to these concerns, we have chosen to exclude this data source from our inventory and instead use the IPCC default of 0 methane recovery. This means that our inventory may overestimate emissions from solid waste landfills.

{{< include data_solid_waste_methods.qmd >}}

## Data Validation

### Correlation with related data

We would expect counties with a higher population to have higher solid waste emissions.

```{r fig-emissions-population-solidwaste}
#| fig-cap: "County population and solid waste emissions"
#| out-width: "95%"
cprg_population <- readRDS(file.path(here::here(), "_meta/data/cprg_population.RDS"))

solidwaste_totals <- county_emissions %>%
  filter(category == "Solid waste") %>%
  group_by(geog_name) %>%
  summarise(
    emissions_metric_tons_co2e = sum(emissions_metric_tons_co2e)
  )

solidwaste_population <- left_join(solidwaste_totals, cprg_population,
  by = c("geog_name" = "NAME")
)

fig_emissions_population_solidwaste <- plot_ly(
  data = solidwaste_population,
  source = "fig-emissions-population-solidwaste",
  x = ~population,
  y = ~emissions_metric_tons_co2e,
  type = "scatter",
  mode = "markers",
  hovertemplate = ~ paste0(
    geog_name, " County", "<br>",
    "Population: ", scales::comma(population), "<br>",
    "Emissions: ", round(emissions_metric_tons_co2e * 1e-6, digits = 2), " million metric tons CO<sub>2</sub>e", "<br>",
    "<extra></extra>"
  ),
  # opacity = 0.7,
  marker = list(
    color = colors$councilBlue,
    size = 18,
    line = list(
      color = "lightgray",
      width = 2
    )
  )
) %>%
  plotly_layout(
    main_title = "County population and solid waste emissions",
    subtitle = "2021 ACS 5-year population estimates. Strong positive correlation",
    x_title = "Total population",
    y_title = "Metric tons CO<sub>2</sub>e",
    legend_title = "",
    legend = list(orientation = "h")
  )

fig_emissions_population_solidwaste
```

## Comparison with other inventories {#sec-waste-inventory-comparison}

#### US Greenhouse Gas Emissions Inventory

The United States EPA conducts a comprehensive yearly estimate of greenhouse gas emissions from multiple sectors and gases. It also publishes statewide totals consistent with the national inventory. These emissions totals are consistent with international standards for greenhouse gas accounting, although they may differ from inventories completed at the state level for various reasons.

US Inventory data for the waste sector in both Minnesota and Wisconsin was downloaded from the [Greenhouse Gas Inventory Data Explorer](https://cfpub.epa.gov/ghgdata/inventoryexplorer/) and processed in R script: [epa_inventory_data.R](/data-raw/epa_inventory_data.R), where it was apportioned from state to county level by population.

```{r fig-federal-inventory-compare}
#| fig-cap:  "Solid waste emissions comparison: Met Council and US GHG Inventory"
#| out-width: "95%"

waste_federal <- solidwaste_totals %>%
  mutate(data_source = "Met Council") %>%
  bind_rows(federal_totals)

fig_federal_inventory_compare <- plot_ly(
  data = waste_federal,
  source = "fig-federal-inventory-compare",
  x = ~geog_name,
  y = ~emissions_metric_tons_co2e,
  color = ~data_source,
  type = "bar",
  colors = c(
    "Met Council" = colors$councilBlue,
    "US GHG Inventory" = cprg_colors$cprg_da_yellow
  ),
  hovertemplate = ~ paste0(
    geog_name, " County", "<br>",
    data_source, "<br>",
    round(emissions_metric_tons_co2e * 1e-3, digits = 0),
    " thousand metric tons CO<sub>2</sub>e", "<br>",
    "<extra></extra>"
  )
) %>%
  councilR::plotly_layout(
    main_title = "Solid waste emissions comparison",
    subtitle = "Met Council estimates compared to US GHG Inventory",
    x_title = "County",
    y_title = "Metric tons CO<sub>2</sub>e",
    legend_title = "Emissions Source"
  ) %>%
  plotly::layout(barmode = "group")

fig_federal_inventory_compare
```


```{r metc-solid-epa-comp}
metc_solidwaste_inventory <- county_emissions %>%
  filter(sector == "Waste") %>%
  mutate(
    data_source = "Met Council",
    year = as.character(year)
  ) %>%
  select(names(epa_waste_inventory))

metc_epa_comp_solid <- epa_waste_inventory %>%
  filter(source != "Total") %>%
  bind_rows(metc_solidwaste_inventory) %>%
  mutate(
    source_unified = case_when(
      # source == "Anaerobic digestion" ~ "Waste to energy",
      TRUE ~ source
    )
  ) %>%
  select(-source)

wide_metc_epa_comp_solid <- metc_epa_comp_solid %>%
  pivot_wider(
    names_from = data_source,
    values_from = emissions_metric_tons_co2e
  ) %>%
  filter(
    !is.na(`Met Council`),
    !is.na(`US GHG Inventory`)
  ) %>%
  mutate(emiss_diff = `US GHG Inventory` - `Met Council`)
```

```{r plot_waste_comparison}
plot_waste_comparison <- function(waste_source,
                                  plotly_source) {
  plot_ly(
    source = plotly_source,
    data = metc_epa_comp_solid %>%
      filter(
        source_unified == waste_source
      ),
    y = ~geog_name,
    x = ~emissions_metric_tons_co2e,
    color = ~data_source,
    colors = c(
      "Met Council" = colors$councilBlue,
      "US GHG Inventory" = cprg_colors$cprg_da_yellow
    ),
    hovertemplate = ~ paste0(
      geog_name, " County", "<br>",
      data_source, "<br>",
      source_unified, "<br>",
      round(emissions_metric_tons_co2e * 1e-3, digits = 0), " thousand metric tons CO<sub>2</sub>e", "<br>",
      "<extra></extra>"
    ),
    marker = list(size = 18),
    opacity = 0.75,
    type = "scatter",
    mode = "markers"
  ) %>%
    add_segments(
      name = "Difference line",
      data = wide_metc_epa_comp_solid %>%
        filter(source_unified == waste_source),
      y = ~geog_name,
      yend = ~geog_name,
      x = ~`US GHG Inventory`,
      xend = ~`Met Council`,
      showlegend = FALSE,
      inherit = FALSE,
      line = list(
        color = "darkgray",
        size = 2
      )
    ) %>%
    councilR::plotly_layout(
      main_title = paste0(waste_source, " emissions comparison"),
      subtitle = "Met Council vs. US Greenhouse Gas Inventory estimates",
      y_title = "County",
      x_title = "Metric tons CO<sub>2</sub>e",
      legend_title = "Data source"
    ) %>%
    layout(yaxis = list(categoryorder = "total ascending"))
}
```

Wastewater comparisons are very consistent, with the US GHG Inventory consistently estimating more emissions than the EPA derived Met Council estimate. 

```{r fig-metc-epa-ghg-wastewater}
#| fig-cap: "Wastewater emissions comparison by county, EPA-derived Met Council and US GHG Inventory. US inventory consistently higher than Council. "
#| out-width: "95%"

fig_metc_epa_ghg_wastewater <- plot_waste_comparison("Wastewater",
  plotly_source = "fig-metc-epa-ghg-wastewater"
)
fig_metc_epa_ghg_wastewater
```

Solid waste emissions differences vary by county; while Ramsey, Hennepin and Washington county estimates from the US GHG Inventory are higher than the Council estimates, the opposite is true for Dakota and Anoka counties. This is likely related to the fact that Ramsey, Hennepin and Washington counties process a significant portion of their waste in waste-to-energy facilities, reducing the amount of emissions accounted for under the landfill category.

```{r fig-metc-epa-ghg-landfill}
#| fig-cap: "Landfill emissions comparison by county, Met Council and US GHG Inventory. Results vary by county."
#| out-width: "95%"

fig_metc_epa_ghg_landfill <- plot_waste_comparison("Landfill",
  plotly_source = "fig-metc-epa-ghg-landfill"
)
fig_metc_epa_ghg_landfill
```


```{r echo=FALSE}
caption_index <- readRDS(file.path(here::here(), "caption_index.RDS"))
caption_index <- as.character(as.numeric(caption_index) + 1) %>% stringr::str_pad(width = 2, side = "left", pad = "0")
saveCap(paste0("cap-", caption_index))
saveRDS(caption_index, file.path(here::here(), "caption_index.RDS"))
```
{{< pagebreak >}}
