# Waste and wastewater {#sec-waste}
```{r  include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  fig.pos = "H",
  out.width = "100%",
  dpi = 300
)


knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
```


```{r, include=FALSE}
source(file.path(here::here(), "R/_quarto_helpers.R"))
source(file.path(here::here(), "R/_load_pkgs.R"))
source(file.path(here::here(), "R/_plotting_helpers.R"))
cprg_population <- readRDS(file.path(here::here(), "_meta/data/cprg_population.RDS"))
cprg_county <- readRDS(file.path(
  here::here(),
  "_meta/data/cprg_county.RDS"
))

cprg_ctu <- readRDS(file.path(here::here(), "_meta/data/cprg_ctu.RDS"))
county_emissions <- readRDS(file.path(here::here(), "_meta/data/cprg_county_emissions.RDS"))
# this file is currently out of date. please update before adding full sector graphs


emissions_2021 <- county_emissions %>%
  filter(emissions_year == 2021) %>%
  pull(value_emissions) %>%
  sum()
waste_emissions_2021 <- county_emissions %>%
  filter(emissions_year == 2021, sector == "Waste") %>%
  pull(value_emissions) %>%
  sum()
waste_emissions_2005 <- county_emissions %>%
  filter(emissions_year == 2005, sector == "Waste") %>%
  pull(value_emissions) %>%
  sum()

hookaddcap()
```

## Introduction

In 2021, waste activities over the entire United States generated emissions of 169.2 MMTCO~2~e, or 2.7 percent of total U.S. greenhouse gas emissions [@usepaInventoryGreenhouseGas2023]. In the 11-county Twin Cities MSA region, municipal waste produced `r 100*round(waste_emissions_2021)` MMTCO~2~e, or `r 100*round(waste_emissions_2021/emissions_2021, digits = 3)`% of the regional total. 

Solid waste emissions come from the degradation of waste in landfills and composting facilities, as well as from waste incineration. Emissions resulting from transport and energy use in waste processing, including in recycling facilities, are accounted for in the transportation and energy sectors respectively.

In landfills, greenhouse gas emissions come from the gradual degradation of carbon-based materials such as wood, paper and organic waste, which emit methane as they degrade. Likewise, a small amount of methane and nitrous oxide are emitted in aerobic composting. In the metropolitan area, a significant portion of solid waste is also managed with incineration, which emits some carbon dioxide and nitrous oxide in the process. 

Emissions are also generated by industrial waste management and landfilling of construction materials. These activities are not accounted for in this inventory, and are assumed to be associated with a relatively small portion of emissions.

There are already some actions in place to reduce waste emissions in Minnesota. The amount of waste diverted to recycling and composting facilities has steadily increased over time. Unfortunately, landfilled waste has also increased steadily [@SCOREOverview].  Methane capture and recovery in landfills limits but does not prevent methane emissions. In Minnesota, 9 out of 21 open landfills have methane capture [@alexanderMethodologyRegionalIndicators2023]. Some waste is also sent to out-of-state landfills that do not have methane capture systems in place. Methane capture is not accounted for in this version of the inventory (see @sec-epa-methane for more details).

## Results

### Overview

Emissions from waste generated `r round(sum(county_emissions$value_emissions)/1000000 * sector_percentages[[2]][3], digits = 2)` MMtCO~2~e of emissions in the Twin Cities MSA in 2021. Solid waste, including landfills, incineration, and organics, generates the largest share of emissions in the waste sector, with municipal wastewater treatment comprising a smaller share of waste emissions. 

<!-- Waste emissions in Minnesota have declined nearly 40% since 2005 - update with our figures, due to a variety of factors including gas capture technologies and aging waste in open landfills [@mpcaClimateChangeTrends2023]. Waste emissions in Wisconsin show no significant change from 2005 to 2018, possibly due to increased waste generation offsetting reductions from gas capture [@wisconsindnrGreenhouseGas2021]. The Metropolitan Council, which oversees wastewater services for the majority of the urbanized extent of the metropolitan region, continues to work to reduce wastewater emissions across its 9 wastewater treatment plants. -->

<!-- We are underestimating the impact of waste management technologies. -->

2021 by county and subsector
over time

```{r fig-waste-county-emissions}
#| fig-cap: "2021 county agricultural emissions"
#| out-width: "95%"
#| fig.height: 4  # Set height in inches
#| fig.width: 10   # Set width in inches

fig_waste_county_emissions <- plot_ly(
  type = "bar",
  source = "fig-waste-county-emissions",
  data = county_emissions %>%
    filter(
      sector == "Waste",
      emissions_year == 2021
    ),
  y = ~ reorder(county_name, value_emissions),
  x = ~value_emissions,
  color = ~category,
  colors = unlist(category_colors),
  hovertemplate = ~ paste0(
    county_name, "<br>",
    category, "<br>",
    source, "<br>",
    round(value_emissions / 1000000, digits = 2), " million metric tons CO<sub>2</sub>e", "<br>",
    "<extra></extra>"
  )
) %>%
  plotly_layout(
    main_title = "2021 county waste emissions",
    x_title = "Million metric tons CO<sub>2</sub>e",
    subtitle = ""
  ) %>%
  layout(
    barmode = "stack",
    legend = list(
      traceorder = "reversed"
    ),
    hoverlabel = list(
      font = list(
        color = "black" # Set hovertext color to black
      )
    )
  )

fig_waste_county_emissions
```

### Baseline emissions

Regional waste emissions have increased by `r 100*round(1 - (waste_emissions_2021/waste_emissions_2005))`% since 2005, likely tied to population growth despite successful measures to reduce emissions per capita.

```{r fig-waste-baseline-emissions}
#| fig-cap: "Baseline agricultural emissions"
#| out-width: "95%"
#| fig.height: 4  # Set height in inches
#| fig.width: 8   # Set width in inches

fig_waste_baseline <- plot_ly(
  source = "fig-waste-baseline-emissions",
  data = county_emissions %>%
    filter(sector == "Waste") %>%
    group_by(emissions_year, category) %>%
    summarise(value_emissions = sum(value_emissions)),
  x = ~emissions_year,
  y = ~value_emissions,
  color = ~category, #
  colors = unlist(category_colors), # Directly map the colors to categories
  type = "scatter",
  mode = "lines", # No points or lines, just fill
  stackgroup = "one", # Fill to the next y value (stacking)
  hoverinfo = "x+y+name", # Ensure hover displays x, y, and category name
  hovertemplate = ~ paste0(
    "Year: %{x}<br>",
    "Category: %{text}<br>",
    "Emissions: %{y:.2f} metric tons CO<sub>2</sub>e<br>",
    "<extra></extra>"
  ),
  text = ~category # Pass category to hovertext
) %>%
  plotly_layout(
    main_title = "County Waste Emissions Over Time",
    x_title = "Year",
    y_title = "Million metric tons CO<sub>2</sub>e",
    subtitle = ""
  ) %>%
  layout(
    hovermode = "x unified", # Combine all hovertext under one hover
    hoverlabel = list(
      font = list(
        color = "black" # Set hovertext color to black
      )
    )
  )

fig_waste_baseline
```

#### 2021 emissions

```{r solid-waste-percentages, include=FALSE}
solid_waste_percentages <- solid_waste_emissions %>%
  filter(inventory_year == 2021) %>%
  group_by(category, source) %>%
  summarize(value_emissions = sum(value_emissions)) %>%
  arrange(-value_emissions) %>%
  janitor::adorn_percentages(denominator = "col")


total_solid_waste <-
  solid_waste_emissions %>%
  ungroup() %>%
  filter(inventory_year == 2021) %>%
  summarise(value_emissions = sum(value_emissions)) %>%
  extract2("value_emissions")
```

Solid waste generated `r round(total_solid_waste/1000000, digits = 2)` MMtCO~2~e of emissions in the Twin Cities MSA in 2021. Of that total, `r scales::percent(solid_waste_percentages$value_emissions[1], accuracy = 0.1)` of emissions came from `r str_to_lower(solid_waste_percentages$source[1])`, `r scales::percent(solid_waste_percentages$value_emissions[2], accuracy = 0.1)` from `r str_to_lower(solid_waste_percentages$source[2])` facilities, and the remaining `r scales::percent(sum(solid_waste_percentages$value_emissions[3:4]), accuracy = 0.1)` from `r str_to_lower(solid_waste_percentages$source[3])` and `r str_to_lower(solid_waste_percentages$source[4])`.  

```{r fig-solid-waste-emissions}
#| fig-cap: "2021 solid waste emissions"
#| out-width: "95%"
fig_solid_waste_emissions <-
  plot_ly(
    type = "bar",
    source = "fig-solid-waste-emissions",
    data = solid_waste_named %>%
      filter(
        category == "Solid waste",
        inventory_year == 2021
      ),
    y = ~ reorder(county_name, value_emissions),
    x = ~value_emissions,
    color = ~category,
    colors = unlist(category_colors),
    marker = list(
      line = list(
        color = colors$councilBlue
      )
    ),
    hovertemplate = ~ paste0(
      county_name, " County", "<br>",
      category, ", ", source, "<br>",
      round(value_emissions / 1000, digits = 0), " thousand metric tons CO<sub>2</sub>e", "<br>",
      "<extra></extra>"
    )
  ) %>%
  plotly_layout(
    main_title = "2021 solid waste emissions",
    subtitle = "",
    y_title = "County",
    x_title = "Metric tons CO<sub>2</sub>e",
    legend_title = "Category"
  ) %>%
  layout(
    barmode = "stack",
    legend = list(
      traceorder = "reversed"
    ),
    yaxis = list(categoryorder = "total ascending")
  )
fig_solid_waste_emissions
```

Greenhouse gas emissions from solid waste are dominated by the landfill sector. In Hennepin, Ramsey, and Washington counties, municipal centers where a significant portion of waste is incinerated, waste-to-energy or incineration makes up a large fraction of emissions as well. 

```{r fig-solid-waste-sector-emissions-by-category}
#| fig-cap: "2021 solid waste emissions by category"
#| out-width: "95%"

fig_solid_waste_sector_emissions_by_category <-
  plot_ly(
    type = "bar",
    source = "fig-solid-waste-sector-emissions-by-category",
    data = solid_waste_named %>%
      filter(
        category == "Solid waste",
        inventory_year == 2021,
        source != "Onsite"
      ),
    y = ~ reorder(county_name, value_emissions),
    x = ~value_emissions,
    color = ~source,
    colors = unlist(source_colors),
    hovertemplate = ~ paste0(
      county_name, " County", "<br>",
      category, ", ", source, "<br>",
      round(value_emissions / 1000, digits = 0), " thousand metric tons CO<sub>2</sub>e", "<br>",
      "<extra></extra>"
    )
  ) %>%
  plotly_layout(
    main_title = "2021 solid waste emissions by category",
    subtitle = "",
    y_title = "County",
    x_title = "Metric tons CO<sub>2</sub>e",
    legend_title = "Category"
  ) %>%
  layout(
    barmode = "stack",
    legend = list(
      traceorder = "reversed"
    ),
    yaxis = list(categoryorder = "total ascending")
  )
fig_solid_waste_sector_emissions_by_category
```


<!-- consider inserting CTU estimates here -->

#### Historical emissions

The variation of solid waste emissions over the past 16 years is mainly due to variations in amount of waste collected. It does not take into account changes in methane capture and removal technology or adoption.

```{r fig-solid-waste-times-series-county}
#| fig-cap: "Solid waste emissions by county, 2005-2021"
#| out-width: "95%"

fig_solid_waste_time_series_county <- sw_county_summary %>%
  group_by(county_name) %>%
  plot_ly(
    source = "fig-solid-waste-time-series-county",
    x = ~inventory_year,
    y = ~value_emissions,
    color = ~county_name,
    colors = "Dark2",
    type = "scatter",
    mode = "lines+markers",
    marker = list(size = 10),
    hoverinfo = "text",
    hovertext = ~ paste0(
      county_name, "County, ", inventory_year, " ", "<br>",
      rounded_tons
    )
  ) %>%
  plotly_layout(
    main_title = paste0("Solid Waste emissions, ", solid_waste_min_year, " - ", solid_waste_max_year),
    subtitle = "",
    x_title = "Year",
    y_title = "Metric tons CO<sub>2</sub>e",
    legend_title = "County"
  )

fig_solid_waste_time_series_county
```

```{r fig-solid-waste-time-series-source}
#| fig-cap: "Solid waste emissions by source, 2005-2021"
#| out-width: "95%"
#|
sw_source_summary <- solid_waste_named %>%
  group_by(inventory_year, source) %>%
  filter(source != "Onsite") %>%
  summarize(
    value_emissions = sum(value_emissions),
    .groups = "keep"
  ) %>%
  rowwise() %>%
  mutate(rounded_tons = round_emissions_metric_tons_co2e(value_emissions))

fig_solid_waste_time_series_source <- sw_source_summary %>%
  filter(source == "Landfill") %>%
  plot_ly(
    source = "fig-solid-waste-time-series-source",
    x = ~inventory_year,
    y = ~value_emissions,
    name = "Landfill",
    fillcolor = source_colors$Landfill,
    type = "scatter",
    mode = "none",
    stackgroup = "one",
    hoverinfo = "text",
    hovertext = ~ paste0(
      source, " emissions, ", inventory_year, " ", "<br>",
      rounded_tons
    )
  ) %>%
  add_trace(
    data = sw_source_summary %>% filter(source == "Organics"),
    y = ~value_emissions,
    name = "Organics",
    fillcolor = source_colors$Organics
  ) %>%
  add_trace(
    data = sw_source_summary %>% filter(source == "Waste to energy"),
    y = ~value_emissions,
    name = "Waste to energy",
    fillcolor = source_colors$`Waste to energy`
  ) %>%
  plotly_layout(
    main_title = paste0("Solid Waste emissions, ", solid_waste_min_year, " - ", solid_waste_max_year),
    subtitle = "",
    x_title = "Year",
    y_title = "Metric tons CO<sub>2</sub>e",
    legend_title = "Source"
  )

fig_solid_waste_time_series_source
```

### Wastewater


```{r echo=FALSE}
caption_index <- readRDS(file.path(here::here(), "caption_index.RDS"))
caption_index <- as.character(as.numeric(caption_index) + 1) %>% stringr::str_pad(width = 2, side = "left", pad = "0")
saveCap(paste0("cap-", caption_index))
saveRDS(caption_index, file.path(here::here(), "caption_index.RDS"))
```
{{< pagebreak >}}
