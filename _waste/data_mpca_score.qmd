## MPCA SCORE

```{r}
source(file.path(here::here(), "R/_quarto_helpers.R"))
source(file.path(here::here(), "R/_load_pkgs.R"))
# pull data here
mpca_score <- readRDS(file.path(here::here(), "_waste/data/mpca_score.RDS"))
mpca_score_meta <- readRDS(file.path(here::here(), "_waste/data/mpca_score_meta.RDS"))
# PULL IN DATA FROM TRANSPORTATION TO USE:
cprg_county <- readRDS(file.path(here::here(), "R/data/cprg_county.RDS"))
cprg_pop <- readRDS(file.path(here::here(), "R/data/cprg_population.RDS"))
hookaddcap()
```


The Minnesota Pollution Control Agency collects an annual inventory, [SCORE](https://public.tableau.com/app/profile/mpca.data.services/viz/SCOREOverview/1991-2021SCORE), of solid waste, recycling and organics as reported by counties across the state. For this project, we used MPCA data for the nine Minnesota counties for the year 2021.

Data source description, type

- Quality rank (See @tbl-quality-rank)
Highest quality
- How, when, and why was the data collected?
- If this is a modeled dataset, what is the sample?
not modeled - directly reported
- What is the raw unit of measurement? 
- How was this data accessed? Include any relevant links/citations, code, or downloads.
- What data cleaning or wrangling was completed? How did you test these processes and outputs?
- What is the geographic and temporal scope? Did you complete any aggregation?
annual, county-level
- What version is the data? Were there other versions available? If so, why did you choose this version?
- What assumptions are made when we use this dataset?
- Which subject matter expert (SME) reviewed this data?
- Describe testing used to verify data

Be sure to add a citation of this dataset to the Zotero shared library.

### Data characteristics

- Were there any missing data? How did you handle missing data?
Missing WI data
Removed MSW Compost as empty category
- Plots, tables, and description of data distribution
- Variance, Z-Score, quantiles
- Facet views by categorical variables

### Data distribution

To check if the data is reasonable, we can start by visualizing the tons of waste generated for each county, broken into categories. 

We would expect waste from landfills to be greater than recycling in most cases, and both landfill and recycling waste to be greater than compost (or "organics").  We can see that this expectation largely holds true, with the exception of Ramsey County, where compost outstrips both recycling and landfill. Part of the explanation for this may lie in the fact that, like Hennepin and Washington, a large portion of Ramsey County's waste is managed in Waste-to-Energy facilities rather than landfills. This is consistent with waste management strategies of the metropolitan areas within Ramsey, Hennepin and Washington counties (add citation).

We also note that only two counties, Chisago and Sherburne, processed waste through onsite waste processors in 2021.  

```{r fig-total-waste}
#| fig-cap: "Total waste generated by county"
#| out-width: "95%"

# is this too many categories. should i switch to side-by-side bar plot

mpca_score %>%
  filter(!Method == "MSW Compost") %>%
  # pivot_wider(names_from = Method, values_from = Tons, values_fill = 0) %>%
  plot_ly(
    x = ~ reorder(County, -Tons),
    y = ~Tons,
    type = "bar",
    hoverinfo = "text",
    color = ~Method,
    hovertemplate = ~ paste0(
      "County: ", County, "<br>",
      "Management method: ", Method, "<br>",
      "Waste generated: ", round(Tons / 1000), " thousand tons",
      "<extra></extra>"
    )
  ) %>%
  plotly_layout(
    main_title = "Total waste generated per county",
    x_title = "County",
    y_title = "Waste (tons)",
    legend_title = "Management Method",
    barmode = "stack"
  ) %>%
  layout(
    barmode = "stack"
  )
```


```{r fig-waste-county-area}
#| fig-cap: "Total waste generated by county and county area"
#| out-width: "95%"
#| include: false

# Ignored exploration of area vs. total waste - little correlation, compare to area vs. pop
cprg_area_mn <- cprg_county %>%
  mutate(area_sq_mi = sf::st_area(cprg_county) %>% units::set_units("mi^2") %>%
    as.numeric()) %>%
  filter(STATE == "Minnesota")

mpca_score %>%
  filter(!Method == "MSW Compost") %>%
  group_by(County) %>%
  mutate(Total = sum(Tons)) %>%
  full_join(cprg_area_mn, by = join_by(County == NAME)) %>%
  plot_ly(
    x = ~area_sq_mi,
    y = ~Total,
    type = "scatter",
    mode = "markers",
    hoverinfo = "text",
    hovertemplate = ~ paste0(
      "County: ", County, "<br>",
      "Waste generated: ", round(Total / 1000), " thousand tons", "<br>",
      "Area: ", round(area_sq_mi), " sq mi",
      "<extra></extra>"
    )
  ) %>%
  plotly_layout(
    main_title = "Total waste by county area",
    x_title = "Area (sq. mi.)",
    y_title = "Waste (tons)"
  )
```

We would expect that counties with large populations would generate more waste and smaller counties would generate less.

Comparing waste generated and population, we see a general positive correlation.

```{r fig-waste-county-pop}
#| fig-cap: "Total waste generated by county and county population"
#| out-width: "95%"
cprg_pop_mn <- cprg_pop %>%
  filter(STATE == "Minnesota")

mpca_score %>%
  filter(!Method == "MSW Compost") %>%
  group_by(County) %>%
  mutate(Total = sum(Tons)) %>%
  full_join(cprg_pop_mn, by = join_by(County == NAME)) %>%
  plot_ly(
    x = ~population,
    y = ~Total,
    type = "scatter",
    mode = "markers",
    hoverinfo = "text",
    hovertemplate = ~ paste0(
      "County: ", County, "<br>",
      "Waste generated: ", round(Total / 1000), " thousand tons", "<br>",
      "Population: ", round(population),
      "<extra></extra>"
    )
  ) %>%
  plotly_layout(
    main_title = "Total waste by county population",
    x_title = "Population",
    y_title = "Waste (tons)"
  )
```


```{r echo =FALSE}
saveCap("mpca-score")
```
