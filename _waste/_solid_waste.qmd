# Waste and wastewater {#sec-waste}
```{r  include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  fig.pos = "H",
  out.width = "100%",
  dpi = 300
)


knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
```
```{r, include=FALSE}
source(file.path(here::here(), "R/_quarto_helpers.R"))
source(file.path(here::here(), "R/_load_pkgs.R"))
source(file.path(here::here(), "R/_plotting_helpers.R"))
cprg_population <- readRDS(file.path(here::here(), "_meta/data/cprg_population.RDS"))
cprg_county <- readRDS(file.path(here::here(),
"_meta/data/cprg_county.RDS"))

cprg_ctu <- readRDS(file.path(here::here(), "_meta/data/cprg_ctu.RDS"))
# county_emissions <- readRDS(file.path(here::here(), "_meta/data/cprg_county_emissions.RDS"))
# this file is currently out of date. please update before adding full sector graphs

# county_emissions_summary <- county_emissions %>%
#   group_by(sector, category, source, data_source, factor_source) %>%
#   summarize(
#     emissions_metric_tons_co2e = sum(emissions_metric_tons_co2e),
#     .groups = "keep"
#   )

# sector_percentages <- county_emissions_summary %>%
#   group_by(sector) %>%
#   summarize(emissions_metric_tons_co2e = sum(emissions_metric_tons_co2e)) %>%
#   arrange(-emissions_metric_tons_co2e) %>%
#   janitor::adorn_percentages(denominator = "col")


# waste_percentages <- county_emissions_summary %>%
#   filter(sector == "Waste") %>%
#   group_by(category, source) %>%
#   summarize(emissions_metric_tons_co2e = sum(emissions_metric_tons_co2e), .groups = "keep") %>%
#   arrange(-emissions_metric_tons_co2e) %>%
#   janitor::adorn_percentages(denominator = "col")

solid_waste_emissions <- readRDS(file.path(here::here(),
"_waste/data/final_solid_waste_allyrs.RDS"))

solid_waste_named <- solid_waste_emissions %>% 
  left_join(cprg_county,
            by = join_by(geoid)) %>% 
  select(
    inventory_year,
    sector,
    category,
    source,
    value_emissions,
    county_name,
    county_name_full
  )


sw_county_summary <- solid_waste_named %>%
  group_by(inventory_year, county_name) %>%
  summarize(
    emissions_metric_tons_co2e = sum(value_emissions),
    .groups = "keep"
  ) %>%
  rowwise() %>%
  mutate(rounded_tons = round_emissions_metric_tons_co2e(emissions_metric_tons_co2e))

solid_waste_max_year <- solid_waste_emissions %>%
  filter(inventory_year == max(inventory_year)) %>%
  extract2("inventory_year") %>%
  unique()


solid_waste_min_year <- solid_waste_emissions %>%
  filter(inventory_year == min(inventory_year)) %>%
  extract2("inventory_year") %>%
  unique()

hookaddcap()
```

## Introduction

In 2021, waste activities over the entire United States generated emissions of 169.2 MMTCO~2~e, or 2.7 percent of total U.S. greenhouse gas emissions [@usepaInventoryGreenhouseGas2023]. 

[wastewater emissions description here]

Solid waste emissions come from the degradation of waste in landfills and composting facilities, as well as from waste incineration. Emissions resulting from transport and energy use in waste processing, including in recycling facilities, are accounted for in the transportation and energy sectors respectively.

In landfills, greenhouse gas emissions come from the gradual degradation of carbon-based materials such as wood, paper and organic waste, which emit methane as they degrade. Linkewise, a small amount of methane and nitrous oxide are emitted in aerobic composting. In the metropolitan area, a significant portion of solid waste is also managed with incineration, which emits some carbon dioxide and nitrous oxide in the process. 

Emissions are also generated by industrial waste management and landfilling of construction materials. These activities are not accounted for in this inventory, and are assumed to be associated with a relatively small portion of emissions.

There are already some actions in place to reduce waste emissions in Minnesota. The amount of waste diverted to recycling and composting facilities has steadily increased over time. Unfortunately, landfilled waste has also increased steadily. (SCORE) Methane capture and recovery in landfills limits but does not prevent methane emissions. In Minnesota, 9 out of 21 open landfills have methane capture (RII). Some waste is also sent to out-of-state landfills that do not have methane capture systems in place. Methane capture is not accounted for in this version of the inventory (see @sec-epa-methane for more details).

## Results

### Overview

Emissions from waste make up the third-largest of the emissions sectors in the Twin Cities MSA. Waste generated `r round(sum(county_emissions$emissions_metric_tons_co2e)/1000000 * sector_percentages[[2]][3], digits = 2)` MMtCO~2~e of emissions in the Twin Cities MSA in 2021. Solid waste, including landfills, incineration, and organics, generates the largest share of emissions in the waste sector, with municipal wastewater treatment comprising a smaller share of waste emissions. 

<!-- Waste emissions in Minnesota have declined nearly 40% since 2005 - update with our figures, due to a variety of factors including gas capture technologies and aging waste in open landfills [@mpcaClimateChangeTrends2023]. Waste emissions in Wisconsin show no significant change from 2005 to 2018, possibly due to increased waste generation offsetting reductions from gas capture [@wisconsindnrGreenhouseGas2021]. The Metropolitan Council, which oversees wastewater services for the majority of the urbanized extent of the metropolitan region, continues to work to reduce wastewater emissions across its 9 wastewater treatment plants. -->

<!-- We are underestimating the impact of waste management technologies. -->

2021 by county and subsector
over time

```{r fig-waste-wastewater-county-emissions}
#| fig-cap: "Solid waste and wastewater county emissions"
#| out-width: "95%"
# fig_waste_wastewater_county_emissions <-
#   plot_county_sector_emissions(county_emissions,
#     .sector = "Waste",
#     .plotly_source = "fig-waste-wastewater-county-emissions"
#   )
# 
# fig_waste_wastewater_county_emissions$x$layoutAttrs[[1]]$title$text <- "Solid waste and wastewater emissions"
# 
# fig_waste_wastewater_county_emissions
```


```{r fig-waste-county-emissions-by-category}
#| fig-cap: "Solid waste and wastewater county emissions by category"
#| out-width: "95%"

# fig_waste_county_emissions_by_category <- plot_county_emissions(
#   county_emissions = county_emissions,
#   .sector = "Waste",
#   .plotly_source = "fig-waste-county-emissions-by-category"
# )
# 
# fig_waste_county_emissions_by_category$x$layoutAttrs[[1]]$title$text <- "Solid waste and wastewater emissions"
# 
# fig_waste_county_emissions_by_category
```

### Solid waste

#### 2021 emissions

```{r solid-waste-percentages, include=FALSE}
solid_waste_percentages <- solid_waste_emissions %>%
  filter(inventory_year == 2021) %>% 
  group_by(category, source) %>%
  summarize(emissions_metric_tons_co2e = sum(value_emissions)) %>%
  arrange(-emissions_metric_tons_co2e) %>%
  janitor::adorn_percentages(denominator = "col")


total_solid_waste <-
  solid_waste_emissions %>%
  ungroup() %>%
  filter(inventory_year == 2021) %>% 
  summarise(emissions_metric_tons_co2e = sum(value_emissions)) %>%
  extract2("emissions_metric_tons_co2e")
```

Solid waste generated `r round(total_solid_waste/1000000, digits = 2)` MMtCO~2~e of emissions in the Twin Cities MSA in 2021. Of that total, `r scales::percent(solid_waste_percentages$emissions_metric_tons_co2e[1], accuracy = 0.1)` of emissions came from `r str_to_lower(solid_waste_percentages$source[1])`, `r scales::percent(solid_waste_percentages$emissions_metric_tons_co2e[2], accuracy = 0.1)` from `r str_to_lower(solid_waste_percentages$source[2])` facilities, and the remaining `r scales::percent(sum(solid_waste_percentages$emissions_metric_tons_co2e[3:4]), accuracy = 0.1)` from `r str_to_lower(solid_waste_percentages$source[3])` and `r str_to_lower(solid_waste_percentages$source[4])`.  

```{r fig-solid-waste-emissions}
#| fig-cap: "2021 solid waste emissions"
#| out-width: "95%"
fig_solid_waste_emissions <-
  plot_ly(
    type = "bar",
    source = "fig-solid-waste-emissions",
    data = solid_waste_named %>%
      filter(category == "Solid waste",
             inventory_year == 2021),
    y = ~ reorder(county_name, value_emissions),
    x = ~value_emissions,
    color = ~category,
    colors = unlist(category_colors),
    marker = list(
      line = list(
        color = colors$councilBlue
      )
    ),
    hovertemplate = ~ paste0(
      county_name, " County", "<br>",
      category, ", ", source, "<br>",
      round(value_emissions / 1000, digits = 0), " thousand metric tons CO<sub>2</sub>e", "<br>",
      "<extra></extra>"
    )
  ) %>%
  plotly_layout(
    main_title = "2021 solid waste emissions",
    subtitle = "",
    y_title = "County",
    x_title = "Metric tons CO<sub>2</sub>e",
    legend_title = "Category"
  ) %>%
  layout(
    barmode = "stack",
    legend = list(
      traceorder = "reversed"
    ),
    yaxis = list(categoryorder = "total ascending")
  )
fig_solid_waste_emissions
```

Greenhouse gas emissions from solid waste are dominated by the landfill sector. In Hennepin, Ramsey, and Washington counties, municipal centers where a significant portion of waste is incinerated, waste-to-energy or incineration makes up a large fraction of emissions as well. 

```{r fig-solid-waste-sector-emissions-by-category}
#| fig-cap: "2021 solid waste emissions by category"
#| out-width: "95%"

fig_solid_waste_sector_emissions_by_category <-
  plot_ly(
    type = "bar",
    source = "fig-solid-waste-sector-emissions-by-category",
    data = solid_waste_named %>%
      filter(category == "Solid waste",
             inventory_year == 2021,
             source != "Onsite"),
    y = ~ reorder(county_name, value_emissions),
    x = ~value_emissions,
    color = ~source,
    colors = unlist(source_colors),
    hovertemplate = ~ paste0(
      county_name, " County", "<br>",
      category, "<br>",
      round(value_emissions / 1000, digits = 0), " thousand metric tons CO<sub>2</sub>e", "<br>",
      "<extra></extra>"
    )
  ) %>%
  plotly_layout(
    main_title = "2021 solid waste emissions by category",
    subtitle = "",
    y_title = "County",
    x_title = "Metric tons CO<sub>2</sub>e",
    legend_title = "Category"
  ) %>%
  layout(
    barmode = "stack",
    legend = list(
      traceorder = "reversed"
    ),
    yaxis = list(categoryorder = "total ascending")
  )
fig_solid_waste_sector_emissions_by_category
```


<!-- consider inserting CTU estimates here -->

#### Historical emissions

The variation of solid waste emissions over the past 16 years is mainly due to variations in amount of waste collected. It does not take into account changes in methane capture and removal technology or adoption.

```{r fig-solid-waste-times-series-county}
#| fig-cap: "Solid waste emissions by county, 2005-2021"
#| out-width: "95%"

fig_solid_waste_time_series_county <- sw_county_summary %>%
  group_by(county_name) %>%
  plot_ly(
    source = "fig-solid-waste-time-series-county",
    x = ~inventory_year,
    y = ~emissions_metric_tons_co2e,
    color = ~county_name,
    colors = "Dark2",
    type = "scatter",
    mode = "lines+markers",
    marker = list(size = 10),
    hoverinfo = "text",
    hovertext = ~ paste0(
      county_name, "County, ", inventory_year, " ", "<br>",
      rounded_tons
    )
  ) %>%
  plotly_layout(
    main_title = paste0("Solid Waste emissions, ", solid_waste_min_year, " - ", solid_waste_max_year),
    subtitle = "",
    x_title = "Year",
    y_title = "Metric tons CO<sub>2</sub>e",
    legend_title = "County"
  )

fig_solid_waste_time_series_county
```

```{r fig-solid-waste-time-series-source}
#| fig-cap: "Solid waste emissions by source, 2005-2021"
#| out-width: "95%"
#| 
sw_source_summary <- solid_waste_named %>%
  group_by(inventory_year, source) %>%
  filter(source != "Onsite") %>% 
  summarize(
    emissions_metric_tons_co2e = sum(value_emissions),
    .groups = "keep"
  ) %>%
  rowwise() %>%
  mutate(rounded_tons = round_emissions_metric_tons_co2e(emissions_metric_tons_co2e))

fig_solid_waste_time_series_source <- sw_source_summary %>%
  filter(source == "Landfill") %>%
  plot_ly(
    source = "fig-solid-waste-time-series-source",
    x = ~inventory_year,
    y = ~emissions_metric_tons_co2e,
    name = "Landfill",
    fillcolor = source_colors$Landfill,
    type = "scatter",
    mode = "none",
    stackgroup = "one",
    hoverinfo = "text",
    hovertext = ~ paste0(
      source, " emissions, ", inventory_year, " ", "<br>",
      rounded_tons
    )
  ) %>%
  add_trace(
    data = sw_source_summary %>% filter(source == "Organics"),
    y = ~emissions_metric_tons_co2e,
    name = "Organics",
    fillcolor = source_colors$Organics
  ) %>% 
  add_trace(
    data = sw_source_summary %>% filter(source == "Waste to energy"),
    y = ~emissions_metric_tons_co2e,
    name = "Waste to energy",
    fillcolor = source_colors$`Waste to energy`
  ) %>% 
  plotly_layout(
    main_title = paste0("Solid Waste emissions, ", solid_waste_min_year, " - ", solid_waste_max_year),
    subtitle = "",
    x_title = "Year",
    y_title = "Metric tons CO<sub>2</sub>e",
    legend_title = "Source"
  )

fig_solid_waste_time_series_source
```

### Wastewater


```{r echo=FALSE}
caption_index <- readRDS(file.path(here::here(), "caption_index.RDS"))
caption_index <- as.character(as.numeric(caption_index) + 1) %>% stringr::str_pad(width = 2, side = "left", pad = "0")
saveCap(paste0("cap-", caption_index))
saveRDS(caption_index, file.path(here::here(), "caption_index.RDS"))
```
{{< pagebreak >}}
