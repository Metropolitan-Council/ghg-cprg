# Executive summary {.unnumbered}
```{r}
source(file.path(here::here(), "R/_load_pkgs.R"))
source(file.path(here::here(), "R/_quarto_helpers.R"))
source(file.path(here::here(), "R/plot_county_emissions.R"))


county_emissions <- readRDS(file.path(here::here(), "_meta/data/cprg_county_emissions.RDS"))

county_emissions_summary <- county_emissions %>%
  group_by(sector, category, source, data_source, factor_source) %>%
  summarize(
    emissions_metric_tons_co2e = sum(emissions_metric_tons_co2e),
    .groups = "keep"
  )

hookaddcap()
```

Overall emissions

```{r fig-county-emissions-sector}
#| fig-cap: "County emissions by sector and category"
#| out-width: "95%"
plot_ly(
  data = county_emissions_summary,
  source = opts_current$get()$label,
  x = ~sector,
  y = ~emissions_metric_tons_co2e,
  color = ~category,
  split = ~category,
  type = "bar",
  marker = list(
    line = list(
      color = "lightgray",
      width = 1.3
    )
  ),
  hovertemplate = ~ paste0(
    sector, ", ", source, " - ", category, "<br>",
    round(emissions_metric_tons_co2e * 1e-6, digits = 2), " million metric tons CO<sub>2</sub>e", "<br>",
    "<extra></extra>"
  )
) %>%
  plotly_layout("11-county regional greenhouse gas emissions, 2021",
    subtitle = "",
    x_title = "Sector",
    y_title = "Metric tones CO<sub>2</sub>e",
    legend_title = "Category",
    barmode = "stack"
  )
```
## Emissions by sector

```{r fig-transportation-emissions}
#| fig-cap: "Transportation county level emissions"
#| out-width: "95%"
plot_county_emissions(
  county_emissions = county_emissions,
  .sector = "Transportation",
  .plotly_source = opts_current$get()$label
)
```

```{r fig-energy-emissions}
#| fig-cap: "Energy county level emissions"
#| out-width: "95%"
plot_county_emissions(
  county_emissions = county_emissions,
  .sector = "Energy",
  .plotly_source = opts_current$get()$label
)
```

```{r fig-waste-emissions}
#| fig-cap: "Waste and wastewater county level emissions"
#| out-width: "95%"
plot_county_emissions(
  county_emissions = county_emissions,
  .sector = "Waste",
  .plotly_source = opts_current$get()$label
)
```


## About this document

This is a Quarto book. Code, data, and documentation are all stored in the same place. We primarily use R. 

- To navigate from chapter to chapter, click on the chapter name in the left sidebar or click the arrow button at the end of the page.
- Citations can be previewed by hovering your mouse over the citation.
- Links to R scripts are available throughout the document. Click on the link to open the relevant R script and peruse the code behind this inventory.
- All plots are interactive. Hover your mouse over any bar or dot, and detailed information will appear. If you want to take a static screenshot of a plot, hover your mouse over the plot and find the camera icon in the upper right tool bar.
- Sections are cross-referenced throughout the document. Click on a "Section x.xx.xx" link to navigate to the appropriate section
- All headings, tables, and figures are permalinked, meaning that you can share specific sections of the document through a URL. Hover your mouse over a heading and click on the link icon. Then, copy the URL in your browser and share with colleagues. 


```{r echo=FALSE}
caption_index <- readRDS(file.path(here::here(), "caption_index.RDS"))
caption_index <- as.character(as.numeric(caption_index) + 1) %>% stringr::str_pad(width = 2, side = "left", pad = "0")
saveCap(paste0("cap-", caption_index))
saveRDS(caption_index, file.path(here::here(), "caption_index.RDS"))
```

{{< pagebreak >}}

