## EPA MOVES
```{r}
source(file.path(here::here(), "R/_load_pkgs.R"))
source(file.path(here::here(), "R/_quarto_helpers.R"))
library(gt)
epa_moves <- readRDS(file.path(here::here(), "_transportation/data/epa_moves.RDS"))
epa_moves_meta <- readRDS(file.path(here::here(), "_transportation/data/epa_moves_meta.RDS"))
hookaddcap()
```

Emissions rates for our region were calculated using the EPA's [Motor Vehicle Emissions Simulator (MOVES4)](https://www.epa.gov/moves) [@usepaMotorVehicleEmission2023]. MOVES4 calculates emissions factors using Council's regional travel demand model, Minnesota Department of Vehicle Services county vehicle registration data, and the Minnesota Pollution Control Agency vehicle age distribution. Each of these inputs helps the model estimate the characteristics of vehicles on the road in our region. The model takes into account differences in fuel economy (miles per gallon) depending on a vehicle's age and size, as well as its fuel intake (diesel or gasoline). The results are specific to the conditions of our region, and so are more accurate than national averages. 

```{r tbl-epa-moves-values}
#| tbl-cap: "Emissions in grams per vehicle mile traveled by vehicle weight in the Twin Cities region" 
epa_moves %>% 
  kable(col.names = 
          c("MOVES Year",
            "Vehicle weight",
            "CO~2~",
            "CO~2~ and CO~2~ equivalent",
            "CH~4~",
            "N~2~O"))
```


Data source description, type

- Quality rank (See @tbl-quality-rank)
- How, when, and why was the data collected?
- If this is a modeled dataset, what is the sample?
- What is the raw unit of measurement? 
- How was this data accessed? Include any relevant links/citations, code, or downloads.
- What data cleaning or wrangling was completed? How did you test these processes and outputs?
- What is the geographic and temporal scope? Did you complete any aggregation?
- What version is the data? Were there other versions available? If so, why did you choose this version?
- What assumptions are made when we use this dataset?
- Which subject matter expert (SME) reviewed this data?
- Describe testing used to verify data

Be sure to add a citation of this dataset to the Zotero shared library.

### Data characteristics

- Were there any missing data? How did you handle missing data?
- Plots, tables, and description of data distribution
- Variance, Z-Score, quantiles
- Facet views by categorical variables

### Global Warming Potential

### Vehicle classification 

MnDOT classifies and reports vehicles weight distributions using FHWA standards, as compared with their visual vehicle classification guide [@]

StreetLight classifies commercial vehicles by Federal Highway Administration (FHWA) gross vehicle weight range (GWVR) classes: where vehicles between 14,000 lbs and 26,000 lbs (Class 4 to Class 6) are considered medium-duty, and vehicles greater than 26,000 lbs (Class 7+) are heavy-duty [@streetlightdataTruckTravelMode2023]. 

EPA's Motor Vehicle Emissions Simulator (MOVES4) has their own, slightly different vehicle classification system [@usepaPopulationActivityOnroad2023].  

After reviewing MnDOT's [visual definitions of commercial vehicles](https://www.dot.state.mn.us/traffic/data/reports/wim/Definitions_of_Visual_Classifications_of_Heavy_Commercial_Vehicles.pdf), we defined MnDOT vehicle types 4-7 as medium-duty and types 8-13 as heavy-duty. We believe this configuration aligns most closely with both StreetLight's and MOVES4' vehicle classifications schemes.

However, vehicles falling in FHWA class 7 (> 26,000 lbs, < 33,000 lbs) are classfifed as medium duty by state DOTs, and heavy duty by StreetLight. This discrepancy is relatively small, 


<iframe style="width: 900px; height: 1073.15px;" src="https://afdc.energy.gov/data/widgets/10380" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe>


```{r tbl-vehicle-weight-classifications}
#| tbl-cap: "Vehicle weight classifications by data source" 
vehicle_weight_comp <- 
  tribble(
    ~`Gross vehicle weight rating (lbs)`, ~`FHWA`, ~`DOT`, ~`StreetLight`,
    "<6000",  "Class 1: <6,000 lbs",    "Light-duty", "Light-duty",
    "10,000",  "Class 2: 6,001-10,000lbs",  "Light-duty", "Light-duty",
    "14,000",  "Class 3: 10,001-14,000 lbs",  "Light-duty", "Light-duty",
    "16,000",  "Class 4: 14,001-16,000 lbs", "Medium-duty", "Medium-duty",
    "19,500",  "Class 5: 16,001-19,500 lbs", "Medium-duty", "Medium-duty",
    "26,000",  "Class 6: 19,501-26,000 lbs", "Medium-duty", "Medium-duty",
    "33,000",  "Class 7: 26,001-33,000 lbs", "Medium-duty", "Heavy-duty",
    ">33,000",  "Class 8+: >33,001 lbs", "Heavy-duty", "Heavy-duty"
  ) 

gt::gt(vehicle_weight_comp,
       row_group_as_column = FALSE) %>% 
  tab_style(
    style =  list(cell_fill(color = "lightgray",
                            alpha = 0.5),
                  cell_borders(sides= "top")),
    locations = cells_body(
      columns = 3:4,
      rows = 1:3
    )) %>% 
  tab_style(
    style =  list(cell_fill(color = "lightblue",
                            alpha = 0.5),
                  cell_borders(sides= "top")),
    locations = cells_body(
      columns = 3:4,
      rows = 4:6
    )) %>% 
  tab_style(
    style =  list(cell_fill(color = "lightblue",
                            alpha = 0.5),
                  cell_borders(sides= "top")),
    locations = cells_body(
      columns = 3,
      rows = 7
    )) %>% 
  
  tab_style(
    style =  list(cell_fill(color = "lightgreen",
                            alpha = 0.5),
                  cell_borders(sides= "top")),
    locations = cells_body(
      columns = 3:4,
      rows = 8
    )) %>% 
  tab_style(
    style =  list(cell_fill(color = "lightgreen",
                            alpha = 0.5),
                  cell_borders(sides= "top")),
    locations = cells_body(
      columns = 4,
      rows = 7
    )) %>% 
  as_raw_html()

```



### Limitations

### Comparison with similar datasets

Compare with [GHG Emission Factors Hub](https://www.epa.gov/climateleadership/ghg-emission-factors-hub)

### Data dictionary

Table with detailed description of columns and definitions for each data table.


```{r echo=FALSE}
saveCap("epa-moves")
```
