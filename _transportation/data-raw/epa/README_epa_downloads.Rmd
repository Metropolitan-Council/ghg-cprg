---
title: EPA download guide
output:
    html_document: 
        keep_md: no
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  eval = TRUE,
  echo = FALSE,
  comment = "#>"
)

options(htmltools.dir.version = FALSE,
        crayon.enabled = TRUE)
old.hooks <- fansi::set_knit_hooks(knitr::knit_hooks)

source(file.path(here::here(), "R/_load_pkgs.R"))

epa_downloads <- readxl::read_xlsx(file.path(here::here(), "_transportation/data-raw/epa/epa_downloads.xlsx")) %>% 
    mutate(
    direct_link = map(direct_link, ~ htmltools::a(href = .x, .x)) %>% 
      map(~ gt::html(as.character(.x)))) 

```


This document details how the _transportation/data-raw/epa/ folder is organized and lists the associated processing scripts for each dataset. 

Altogether, this folder comes to nearly 200 GB. If you plan to replicate these downloads on your machine, account for space accordingly.

All download links and essential description information is documented in [epa_downloads.xlsx](_transportation/data-raw/epa/epa_downloads.xlsx)

Keep in mind that URLs are relatively fragile and may change at any time. 

## Folder structure

Note that to save space, some unzipped data irrelevant to our region (like EPA regions outside of MN and WI, Texas, and California datasets) have been deleted. 

```{r}
fs::dir_tree(".",
             type = "directory",
             recurse = 0)
```
### nei

The NEI is available from the EPA in multiple places at different aggregation levels

NEI should only be compared directly for years 2011 onward. Between 2008 and 2011, there were significant changes in the underlying source classification codes (SCCs).

Within the epa/ folder, create folders for each NEI release year: 2008, 2011, 2014, 2017, and 2020.

```{r}
fs::dir_tree(
  "./nei",
  # path_common("../../../_transportation/data-raw/epa/nei/"),
  type = "directory",
  recurse = 0
)
```


Next, navigate to the links provided in the epa_downloads. These are data summaries broken out by on-road and non-road by EPA region. 

When prompted to download, save each download its the corresponding folder. 

```{r tbl-nei-locations}
epa_downloads %>% 
  filter(group == "NEI",
         measurement == "emissions") %>% 
  select(-file_name, -description) %>% 
  arrange(category, inventory_year) %>% 
  gt() %>% 
  gt::opt_row_striping() %>% 
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_column_labels()
  ) %>% 
  gt::cols_align(align = "left")

```


### air_emissions_modeling

EPA teams continually work on air emissions modeling. These emissions modeling platforms support the development of emissions inputs for air quality modeling supporting efforts across government agencies. Platforms include everything from model-ready datasets for models like CMAQ, MOVES, and SMOKE, scripts, output datasets, shapefiles, tables, and documentation. 

The organizing body for air emissions modeling is [Community Modeling and Analysis System (CMAS)](https://www.cmascenter.org/). CMAS offers a [discussion forum](https://forum.cmascenter.org/) for folks to collaborate and ask questions. Staff scientists from the EPA, air quality monitoring agencies, and other organizations answer questions and respond to bug reports. 

County-level data are only available at the continental US (CONUS) level; these datasets include all counties in the US and are very large. 

#### Air emissions modeling platforms

The data available for each platform year varies. Data is much more consistently available and standardized from 2014 onward. 


```{r tbl-emismod-locations}
epa_downloads %>% 
  filter(
    group == "emismod",
         measurement == "emissions",
    inventory_year >= 2011) %>% 
  select(-file_name, -description) %>% 
  arrange(category, inventory_year) %>% 
  gt() %>% 
  gt::opt_row_striping() %>% 
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_column_labels()
  ) %>% 
  gt::cols_align(align = "left")

```


#### EQUATES

> EPA scientists have developed a set of modeled meteorology, emissions, air quality and pollutant deposition spanning the years 2002 through 2019. Modeled datasets cover the Conterminous U.S. (CONUS) at a 12km horizontal grid spacing and the Northern Hemisphere at a 108km grid spacing using the Weather Research and Forecasting (WRF) model version 4.1.1 for simulating weather conditions and EPAâ€™s Community Multiscale Air Quality (CMAQ) model version 5.3.2 for air quality modeling. New hemispheric and North American emissions inventories were developed using, to the extent possible, consistent input data and methods across all years, including emissions from motor vehicles, fires, and oil and gas sources. - [EPA website](https://www.epa.gov/cmaq/equates)



