## EPA Emissions
```{r}
source(file.path(here::here(), "R/_load_pkgs.R"))
source(file.path(here::here(), "R/_quarto_helpers.R"))
source(file.path(here::here(), "R/_plotting_helpers.R"))
hookaddcap()


epa_onroad_source_set <- readRDS(file.path(here::here(), "_transportation/data-raw/epa/epa_onroad_source_set.RDS"))
pollutant_key <- readRDS(file.path(here::here(), "_transportation/data/pollutant_key.RDS"))
pollutant_key_meta <- readRDS(file.path(here::here(), "_transportation/data/epa_onroad_source_set.RDS"))
epa_onroad_emissions_compile <- readRDS(file.path(here::here(), "_transportation/data/epa_onroad_emissions_compile.RDS"))


```


The EPA releases various emissions estimates as part of several programs and initiatives. 

All datasets are compiled from SMOKE flat files downloaded from the EPA website. 


```{r}

```

Each data source and year may use a different MOVES edition. These are listed in [table below].

```{r}
epa_onroad_source_set %>% 
  select(data_source, moves_edition, emissions_year) %>% 
  unique() %>% 
  group_by(data_source, moves_edition) %>% 
  summarize(emissions_years = paste0(emissions_year, collapse = ", "))
```


Various pollutants are available 



```{r}
epa_onroad_emissions_compile %>% 
  filter(!is.na(emissions),
         pollutant != "emissions_metric_tons_co2e") %>% 
  select(emissions_year, interpolation, data_source, pollutant, pollutant_code) %>% 
  unique() %>% 
  group_by(emissions_year, data_source, interpolation) %>% 
  summarize(pollutants_available = paste0(unique(pollutant_code), collapse = ", "))
```


```{r}

pollutant_key %>% 
  select(pollutant_format, pollutant_code, pollutant_desc) %>% 
  gt() %>% 
  gt::as_raw_html()
```


{{< include data_epa_nei.qmd >}}
### Consistent limitations {#sec-epa-emissions-limitations}


- The NEI, EQUATES, and Air Emissions Modeling platforms are based on MOVES, which does not account for activity on local roads. 
- To reduce run times, the EPA uses fuel months to represent summer and winter fuels. The month of January represents October through April (winter), while July represents May through September (summer) [@usepa2020NationalEmissions2023onroad, section 5.6.6.2]. Variation within the summer and winter months is not accounted for using this method. 
- The 2020 NEI had particular challenges due to the COVID-19 pandemic
    - Minnesota did not submit custom data inputs for the 2020 NEI, meaning that inputs to MOVES were based on national default values. Wisconsin submitted custom data for VMT, vehicle population, and road type distribution. Both Minnesota and Wisconsin submitted data for 2017, 2014, and 2011 [@usepa2017NationalEmissions2021, @usepa2014NationalEmissions2018, @usepa2011NationalEmissions2015]. 
    - The NEI augmented vehicle miles traveled (VMT) data for Minnesota and Wisconsin in 2020 using federal and state-level datasets due to data availability issues [@usepaDevelopment2020DefaultData2022]. 
- To reduce model run-time, the EPA groups counties together and only runs MOVES on a single representative county. The resulting MOVES emissions factors are multiplied by county-specific activity data (including VMT, vehicle population, hourly speed distribution, among others) to get county-specific emissions [@usepa2020NationalEmissions2023onroad, section 5.6.2.1]. Effectively, emissions factors are generated on a single representative county, and are then applied to similar counties. 






```{r echo=FALSE}
caption_index <- readRDS(file.path(here::here(), "caption_index.RDS"))
caption_index <- as.character(as.numeric(caption_index) + 1) %>% stringr::str_pad(width = 2, side = "left", pad = "0")
saveCap(paste0("cap-", caption_index))
saveRDS(caption_index, file.path(here::here(), "caption_index.RDS"))
```
{{< pagebreak >}}
