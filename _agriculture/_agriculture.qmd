# Agriculture {#sec-agriculture}
```{r  include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  fig.pos = "H",
  out.width = "100%",
  dpi = 300
)


knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
source(file.path(here::here(), "R/_quarto_helpers.R"))
source(file.path(here::here(), "R/_load_pkgs.R"))
source(file.path(here::here(), "R/_plotting_helpers.R"))

county_emissions <- readRDS(file.path(here::here(), "_meta/data/cprg_county_emissions.RDS"))
ag_emissions <- readRDS(file.path(here::here(), "_agriculture/data/_agricultural_emissions.RDS"))
cprg_county <- readRDS(file.path(here::here(), "_meta/data/cprg_county.RDS"))

emissions_2021 <- county_emissions %>% filter(year == 2021) %>% pull(emissions_metric_tons_co2e) %>% sum()
ag_emissions_2021 <- county_emissions %>% filter(year == 2021, sector == "Agriculture") %>% pull(emissions_metric_tons_co2e) %>% sum()
ag_emissions_2005 <- county_emissions %>% filter(year == 2005, sector == "Agriculture") %>% pull(emissions_metric_tons_co2e) %>% sum()


rural_ag_2021 <- county_emissions %>% 
  filter(year == 2021, sector == "Agriculture",
         geog_name %in% c("St. Croix","Pierce", "Carver", "Dakota")) %>% 
           pull(emissions_metric_tons_co2e) %>% sum()

hookaddcap()
```

## Introduction

Agricultural systems are major emitters of methane and nitrous oxide, both from livestock and croplands. Livestock emissions come primarily from enteric fermentation, the formation of methane in ruminants stomachs during digestion, and secondarily from manure emissions of both methane and nitrous oxides. Cropland emissions are predominantly nitrous oxide that is formed from biogeochemical processes related to crop-soil interactions and the direct application of synthetic fertilizers. Carbon dioxide emissions are a smaller share of agricultural emissions, arising predominantly from operation of agricultural equipment, liming of soils, and production of urea used for fertilizer.


## Results

### 2021 county and subsector breakdown

Agriculture accounted for `r round(ag_emissions_2021/emissions_2021, digits = 3)`% of total emissions in the 11-county region in 2021. As expected, more rural counties produce a larger share of the agricultural emissions, with St. Croix, Pierce, Dakota, and Carver accounting for `r round(rural_ag_2021/ag_emissions_2021, digits = 3)`% of the regions agricultural emissions.

```{r fig-ag-county-emissions}
#| fig-cap: "2021 county agricultural emissions"
#| out-width: "95%"

fig_ag_county_emissions <- plot_ly(
  type = "bar",
  source = "fig-ag-county-emissions",
  data = county_emissions %>%
    filter(sector == "Agriculture",
           year == 2021),
  y = ~ reorder(geog_name, emissions_metric_tons_co2e),
  x = ~emissions_metric_tons_co2e,
  color = ~source,
  colors = unlist(source_colors),
  hovertemplate = ~ paste0(
    geog_name, "<br>",
    source, "<br>",
    round(emissions_metric_tons_co2e / 1000000, digits = 2), " million metric tons CO<sub>2</sub>e", "<br>",
    "<extra></extra>"
  )
) %>%
  plotly_layout(
    main_title = "2021 county agricultural emissions",
    x_title = "Million metric tons CO<sub>2</sub>e",
    subtitle = ""
  ) %>%
  layout(
    barmode = "stack",
    legend = list(
      traceorder = "reversed"
    ),
    hoverlabel = list(
      font = list(
        color = "black"  # Set hovertext color to black
      )
    )
  )

fig_ag_county_emissions
```


### Baseline emissions

Regional agricultural emissions have decreased by 

```{r fig-ag-baseline-emissions}
#| fig-cap: "Baseline agricultural emissions"
#| out-width: "95%"
fig_ag_baseline <- plot_ly(
  source = "fig-ag-baseline-emissions",
  data = county_emissions %>%
    filter(sector == "Agriculture") %>% 
    group_by(year, category) %>% 
    summarise(emissions_metric_tons_co2e = sum(emissions_metric_tons_co2e))%>%
    arrange(year, category),
  x = ~year,
  y = ~emissions_metric_tons_co2e,
  color = ~category,
  colors = unlist(category_colors),
  type = "scatter",
  mode = "none",  # No points or lines, just fill
  fill = "tonexty",  # Fill to the next y value (stacking)
  hovertemplate = ~ paste0(
   "%{x}", "<br>",
    "%{color}", "<br>",
    "%{y:.2f} million metric tons CO<sub>2</sub>e", "<br>",
    "<extra></extra>"
  )
) %>%
  plotly_layout(
    main_title = "County Agricultural Emissions Over Time",
    x_title = "Year",
    y_title = "Million metric tons CO<sub>2</sub>e",
    subtitle = ""
  ) %>%
  layout(
    hoverlabel = list(
      font = list(
        color = "black"  # Set hovertext color to black
      )
    )
  )

fig_ag_baseline
```


```{r fig-ag-county-emissions-by-gas-type}
#| fig-cap: "2021 county agricultural emissions"
#| out-width: "95%"

fig_ag_gas_type <- plot_ly(
  type = "bar",
  source = "fig-ag-county-emissions-by-gas-type",
  data = ag_emissions %>%
    left_join(.,cprg_county) %>% 
    filter(inventory_year == 2021),
  y = ~ reorder(county_name , value_emissions),
  x = ~ value_emissions ,
  color = ~units_emissions,
  hovertemplate = ~ paste0(
    county_name , "<br>",
    source, "<br>",
    round(value_emissions , digits = 2), "  metric tons of gas", "<br>",
    "<extra></extra>"
  )
) %>%
  plotly_layout(
    main_title = "2021 county agricultural emissions by gas type",
    x_title = "Metric tons of gas emitted",
    subtitle = ""
  ) %>%
  layout(
    barmode = "stack",
    legend = list(
      traceorder = "reversed"
    ),
    hoverlabel = list(
      font = list(
        color = "black"  # Set hovertext color to black
      )
    )
  )

fig_ag_gas_type
```

```{r fig-ag-county-emissions-by-gas-type-co2e}
#| fig-cap: "2021 county agricultural emissions"
#| out-width: "95%"

fig_ag_gas_co2e <- plot_ly(
  type = "bar",
  source = "fig-ag-county-emissions-by-gas-type-co2e",
  data = ag_emissions %>%
    left_join(.,cprg_county) %>% 
    filter(inventory_year == 2021),
  y = ~ reorder(county_name , mt_co2e),
  x = ~ mt_co2e ,
  color = ~units_emissions,
  hovertemplate = ~ paste0(
    county_name , "<br>",
    source, "<br>",
    round(mt_co2e , digits = 2), "  metric tons of CO<sub>2</sub>e", "<br>",
    "<extra></extra>"
  )
) %>%
  plotly_layout(
    main_title = "2021 county agricultural emissions by gas type",
    x_title = "Metric tons CO<sub>2</sub>e",
    subtitle = ""
  ) %>%
  layout(
    barmode = "stack",
    legend = list(
      traceorder = "reversed"
    ),
    hoverlabel = list(
      font = list(
        color = "black"  # Set hovertext color to black
      )
    )
  )

fig_ag_gas_co2e
```
